<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth Redirect</title>
</head>
<body>

<script>
	const clientID = "u-s4t2ud-c14a5526d27b133c2732f5848ea8a11d76ae8e503f6e495cd3016623aa0c382e";
	const clientSecret = "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";

	// Extract the code from the URL
	const urlParams = new URLSearchParams(window.location.search);
	const code = urlParams.get('code');

	// Exchange the code for an access token
	fetch("https://api.intra.42.fr/oauth/token", {
    	method: 'POST',
		headers: {
			'Content-Type': 'application/x-www-form-urlencoded'
		},
		body: `client_id=${clientID}&client_secret=${clientSecret}&code=${code}&redirect_uri=http://localhost:3001/redirect.html&grant_type=authorization_code`
	})
	.then(res => res.json())
	.then(data => {
	console.log("Data:", data);
	const accessToken = data.access_token;
	console.log("Access Token:", accessToken);

	// Use the access token to fetch user details
	return fetch("https://api.intra.42.fr/v2/me", {
		headers: {
		'Authorization': 'Bearer ' + accessToken
		}
	});
	})
	.then(res => res.json())
	.then(user => {
	// Redirect to welcome.html with user's name
	console.log("User Data:", user);
	window.location.href = `http://localhost:3000/welcome.html?name=${user.login}`;
	})
	.catch(error => {
	console.error("Error:", error);
	});
</script>

</body>
</html>
